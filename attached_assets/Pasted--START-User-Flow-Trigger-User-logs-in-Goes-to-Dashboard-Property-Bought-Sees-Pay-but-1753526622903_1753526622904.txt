
ğŸ”° START: User Flow Trigger
âœ… User logs in

âœ… Goes to Dashboard â Property Bought

âœ… Sees "Pay" button on a property with status "accepted"

ğŸŸ¢ Clicks on "Pay" â†’ navigates to /dashboard/user/pay/:offerId

ğŸ—ï¸ Frontend Tasks
1. Set Up Stripe
 Install:
npm install @stripe/react-stripe-js @stripe/stripe-js

 Create Stripe account and get publishable key

 Create .env with:

ini
Copy
Edit
VITE_STRIPE_PUBLISHABLE_KEY=pk_test_...
2. Create Payment Page
 Create a route: /dashboard/user/pay/:offerId

 Create a component: PaymentPage.jsx

 Wrap with <Elements> from Stripe:

jsx
Copy
Edit
<Elements stripe={loadStripe(publishableKey)}>
  <PaymentForm offer={offerData} />
</Elements>
3. Create PaymentForm Component
 Use CardElement, useStripe, useElements

 On useEffect, send POST to /create-payment-intent with offer.amount

 Get clientSecret back

 On form submit:

 Call stripe.confirmCardPayment(clientSecret)

 On success: PATCH /offer-payment/:id with transactionId

ğŸ§ª Backend Tasks
1. Install Stripe
bash
Copy
Edit
npm install stripe
2. Set Stripe Secret Key
 In .env:

ini
Copy
Edit
STRIPE_SECRET_KEY=sk_test_...
3. Create Payment Intent Route
 POST /api/create-payment-intent

 Body: { amount }

 Return clientSecret

4. Create Offer Update Route
 PATCH /api/offer-payment/:id

 Body: { transactionId }

 Set:

js
Copy
Edit
{
  status: "bought",
  transactionId: "pi_123..."
}
ğŸ§  Database Tasks (MongoDB)
 Ensure Offers collection has:

status: pending | accepted | bought

offerAmount

transactionId (nullable)

ğŸ§ª Testing Tasks
 Use Stripe test card: 4242 4242 4242 4242

 Use valid expiry date, CVC, ZIP

 Check Stripe Dashboard â Test mode â Payments

 Ensure MongoDB status: bought and transactionId saved

âœ… Post-Payment Tasks
 Replace "Pay" button with:

â€œPaidâ€

Transaction ID: pi_123...

 Show toast: "Payment successful!"

âœ… Final Flow Recap (Plain Language)
User makes an offer

Agent accepts the offer

User clicks Pay

Stripe processes payment

Backend updates DB

UI shows payment success and transaction ID

ğŸ“ Optional (Bonus)
 Add payment date in DB

 Prevent duplicate payments

 Use React Toasts for all success/error

 Add loading spinner while payment is processing